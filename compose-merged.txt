name: localdeploy
services:
  angular-ui:
    build:
      context: C:\TESTINGAPPFORDEVOPS\practice-software-testing\_docker
      dockerfile: ui.docker
      target: development
    command:
      - bash
      - -c
      - npm install --force && ng serve --host 0.0.0.0 --port 4200
    networks:
      default: null
    ports:
      - mode: ingress
        target: 4200
        published: "4200"
        protocol: tcp
      - mode: ingress
        target: 4200
        published: "14200"
        protocol: tcp
    volumes:
      - type: bind
        source: C:\TESTINGAPPFORDEVOPS\practice-software-testing\sprint5\UI
        target: /app
        bind:
          create_host_path: true
    working_dir: /app
  composer:
    command:
      - install
      - --no-dev
      - --optimize-autoloader
      - --ignore-platform-req=ext-ffi
    depends_on:
      laravel-api:
        condition: service_started
        required: true
    image: composer:2.6.6
    networks:
      default: null
    volumes_from:
      - laravel-api
    working_dir: /var/www
  laravel-api:
    build:
      context: C:\TESTINGAPPFORDEVOPS\practice-software-testing\_docker
      dockerfile: api.docker
      target: development
    environment:
      DB_HOST: mariadb
      DB_PORT: "3306"
      DISABLE_LOGGING: "false"
      PHP_OPCACHE_VALIDATE_TIMESTAMPS: "1"
      host: localhost
    networks:
      default: null
    volumes:
      - type: bind
        source: C:\TESTINGAPPFORDEVOPS\practice-software-testing\sprint5\API
        target: /var/www
        bind:
          create_host_path: true
    working_dir: /var/www
  mariadb:
    environment:
      MYSQL_DATABASE: toolshop
      MYSQL_PASSWORD: root
      MYSQL_ROOT_PASSWORD: root
      MYSQL_USER: user
    expose:
      - "3306"
    image: yobasystems/alpine-mariadb:10.6.11
    networks:
      default: null
    ports:
      - mode: ingress
        target: 3306
        published: "3306"
        protocol: tcp
      - mode: ingress
        target: 3306
        published: "13306"
        protocol: tcp
  web:
    build:
      context: C:\TESTINGAPPFORDEVOPS\practice-software-testing\_docker
      dockerfile: web.docker
    depends_on:
      laravel-api:
        condition: service_started
        required: true
    networks:
      default: null
    ports:
      - mode: ingress
        target: 80
        published: "8091"
        protocol: tcp
      - mode: ingress
        target: 81
        published: "8000"
        protocol: tcp
      - mode: ingress
        target: 81
        published: "18000"
        protocol: tcp
    volumes:
      - type: volume
        source: laravel-api
        target: /var/www
        volume: {}
    working_dir: /var/www
networks:
  default:
    name: localdeploy_default
volumes:
  laravel-api:
    name: localdeploy_laravel-api
